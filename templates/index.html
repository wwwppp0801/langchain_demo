<!--doctype html-->
<html>
<head>
    <title>langchain webui</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
</head>
<body>
    <div class="container">
        <div class="row mt-5">
            <form id="form" action="#">
                <div class="form-group col-md-10 d-flex align-items-center">
                    <input type="text" class="form-control" id="input" placeholder="Enter a command">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
                <div class="input-group" id="checkbox_group">
                        <!-- Checkbox 2 -->
                        <div class="input-group-text">
                            <input class="form-check-input" type="checkbox" value="search" id="tool2" checked>
                            <label class="form-check-label" for="tool2">search</label>
                        </div>
                        <!-- Checkbox 1 -->
                        <div class="input-group-text">
                            <input class="form-check-input" type="checkbox" value="wolframalpha_tool" id="tool1" checked>
                            <label class="form-check-label" for="tool1">wolframalpha_tool</label>
                        </div>
                        <!-- Checkbox 3 -->
                        <div class="input-group-text">
                            <input class="form-check-input" type="checkbox" value="ch_en_translator" id= "tool3" checked>
                            <label class= "form-check-label" for= "tool3">ch_en_translator</label>
                        </div>
                        <!-- Checkbox 4 -->
                        <div class="input-group-text">
                            <input class="form-check-input" type="checkbox" value="en_ch_translator" id= "tool4">
                            <label class= "form-check-label" for= "tool4">ch_en_translator</label>
                        </div>
                        <!-- Checkbox 5 -->
                        <div class="input-group-text">
                            <input class="form-check-input" type="checkbox" value="calculator" id= "tool5">
                            <label class= "form-check-label" for= "tool5">calculator</label>
                        </div>
                    </div>
                </form>
            </form>
        </div>
        <h3>程序输出</h1>
        <div id="output" class="well"></div>
        <h3>openai请求日志</h1>
        <div id="errorlog" class="well"></div>
    </div>

    <!-- Load socket.io -->
    <script src="{{ url_for('static', filename='socket.io.js') }}"></script>
    <script src="{{ url_for('static', filename='ansi_up.js') }}"></script>
    <script src="{{ url_for('static', filename='jquery-1.7.2.min.js') }}"></script>

    <!-- Custom script -->
    <script>
        function getToolValues(){
            var tools = $("#checkbox_group input:checked");

            // Create an array to store the values of the checked checkboxes
            var toolValues = [];

            // Loop through each checked checkbox and push its value to the array
            tools.each(function() {
                toolValues.push($(this).val());
            });

            // Join the array elements with a comma separator
            var toolString = toolValues.join(",");
            return toolString
        }
        // Get the socket object
        var socket = io.connect();

        // Get the DOM elements
        var form = document.getElementById('form');
        var input = document.getElementById('input');
        var output = document.getElementById('output');
        var errorlog = document.getElementById('errorlog');

        // Listen for form submit event
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            $("#output").html("")
            $("#errorlog").html("")
            var command = input.value;
            if (command) {
                // Send the command to the server
                socket.emit('submit', {command: command,tools:getToolValues()});
                // Clear the input field
                input.value = '';
            }
        });


        // Listen for result event from the server
        socket.on('result', function(data) {
            var line = data['line'];
            if (line) {
                // Convert ANSI escape codes to HTML tags using ansi_up library (https://github.com/drudru/ansi_up)
                var ansi_up = new AnsiUp;
                var html_line = ansi_up.ansi_to_html(line);
                // Append the result line to the output element
                output.innerHTML += html_line + '<br>';
            }
        });
        socket.on('errorlog', function(data) {
            var line = data['line'];
            if (line) {
                // Convert ANSI escape codes to HTML tags using ansi_up library (https://github.com/drudru/ansi_up)
                var ansi_up = new AnsiUp;
                var html_line = ansi_up.ansi_to_html(line);
                // Append the result line to the output element
                errorlog.innerHTML += html_line + '<br>';
            }
        });
    </script>

</body>
</html>
